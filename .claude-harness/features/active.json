{
  "version": 1,
  "features": [
    {
      "id": "feature-010",
      "name": "Ralph-Style Loop Continuation",
      "description": "Enhance existing /implement command with Ralph methodology: Stop hook blocks exit and re-feeds prompt until verification passes, progress.txt for cross-context continuity, guardrails.md for human-readable failure patterns. No new commands - integrates directly into existing infrastructure.",
      "priority": 1,
      "passes": true,
      "verification": [
        "Stop hook blocks exit when loop is in_progress and re-feeds prompt",
        "progress.txt logs each attempt for cross-context persistence",
        "guardrails.md captures failure patterns in human-readable format",
        "/implement --autonomous flag enables ralph-style continuation",
        "Fresh agent sees progress.txt + guardrails.md on resume",
        "Verification gates still enforced (TDD)",
        "Git commits only after verification passes"
      ],
      "verificationCommands": {
        "build": null,
        "tests": null,
        "lint": null,
        "typecheck": null,
        "custom": [
          "grep -q 'decision.*block' hooks/loop-checkpoint.sh",
          "grep -q 'progress.txt' commands/implement.md",
          "grep -q 'guardrails' commands/implement.md",
          "grep -q 'autonomous' commands/implement.md"
        ]
      },
      "maxAttempts": 10,
      "relatedFiles": [
        "hooks/loop-checkpoint.sh",
        "hooks/hooks.json",
        "commands/implement.md",
        "commands/start.md",
        "setup.sh"
      ],
      "github": {
        "issueNumber": null,
        "prNumber": 19,
        "branch": "feature/feature-010-ralph-loops"
      },
      "createdAt": "2026-01-09T10:30:00Z",
      "phase": "completed",
      "plan": {
        "steps": [
          {
            "step": 1,
            "description": "Enhance loop-checkpoint.sh with Ralph-style continuation",
            "files": ["hooks/loop-checkpoint.sh"],
            "details": "Modify existing Stop hook to check loop state. If status='in_progress' and autonomous=true, output {decision: 'block', systemMessage: 'prompt'} to re-feed the implementation prompt. Check iteration count against max."
          },
          {
            "step": 2,
            "description": "Add progress.txt logging to /implement",
            "files": ["commands/implement.md"],
            "details": "After each attempt, append to .claude-harness/loops/progress.txt: timestamp, attempt number, approach tried, outcome (pass/fail), errors. Human-readable format that fresh agents can parse."
          },
          {
            "step": 3,
            "description": "Add guardrails.md generation on failures",
            "files": ["commands/implement.md"],
            "details": "When same error occurs 2+ times, update .claude-harness/loops/guardrails.md with pattern to avoid. Format: '## Do NOT: {approach} - Reason: {why it fails}'. Fresh agents read this before attempting."
          },
          {
            "step": 4,
            "description": "Add --autonomous flag to /implement",
            "files": ["commands/implement.md"],
            "details": "New flag enables Ralph-style continuation. When set, loop state includes autonomous: true. Without flag, Stop hook allows normal exit (existing behavior)."
          },
          {
            "step": 5,
            "description": "Update loop state schema",
            "files": ["commands/implement.md"],
            "details": "Add to state.json: autonomous (boolean), progressFile (path), guardrailsFile (path). Maintains backward compatibility."
          },
          {
            "step": 6,
            "description": "Update /start to show progress.txt on resume",
            "files": ["commands/start.md", "hooks/session-start.sh"],
            "details": "When active loop exists, display last 5 lines of progress.txt and any guardrails. Gives fresh agent immediate context."
          },
          {
            "step": 7,
            "description": "Update setup.sh for new files",
            "files": ["setup.sh"],
            "details": "Create empty progress.txt and guardrails.md in loops/ directory during setup."
          },
          {
            "step": 8,
            "description": "Add circuit breaker to Stop hook",
            "files": ["hooks/loop-checkpoint.sh"],
            "details": "Safety mechanism: if 3 consecutive attempts have identical errors, switch to 'escalated' status and allow exit. Prevents infinite loops on unsolvable problems."
          },
          {
            "step": 9,
            "description": "Bump version to 3.5.0",
            "files": [".claude-plugin/plugin.json"],
            "details": "Feature release for Ralph-style loop continuation."
          }
        ],
        "estimatedFiles": [
          "hooks/loop-checkpoint.sh",
          "commands/implement.md",
          "commands/start.md",
          "hooks/session-start.sh",
          "setup.sh",
          ".claude-plugin/plugin.json"
        ],
        "impactScore": "medium",
        "risks": [
          "API costs from extended loops",
          "Infinite loops if circuit breaker fails",
          "Stop hook must reliably block/continue"
        ],
        "mitigations": [
          "Circuit breaker after 3 identical errors",
          "Max iterations as hard limit",
          "Test Stop hook extensively"
        ],
        "dependencies": [
          "Claude Code Stop hook with block/continue support",
          "Existing loop infrastructure"
        ],
        "sourceInspiration": {
          "sources": [
            "https://ghuntley.com/ralph/",
            "https://github.com/anthropics/claude-code/tree/main/plugins/ralph-wiggum",
            "https://www.humanlayer.dev/blog/brief-history-of-ralph"
          ],
          "keyPrinciples": [
            "Iteration beats perfection",
            "Progress persists in files, not context",
            "Failures are data",
            "Fresh context avoids accumulated confusion"
          ]
        }
      },
      "tests": {
        "generated": false,
        "files": []
      }
    },
    {
      "id": "feature-009",
      "name": "Brainstorm Mode - Multi-Agent Debate & Consensus Planning",
      "description": "Integrate Ralph Brainstormer's 'Debate & Consensus' pattern into the harness. Create a /brainstorm command that spawns multiple specialized agents to generate competing implementation approaches, rank them, synthesize the best elements, and critique before finalizing. Inspired by alrightryanx/ralph-brainstormer.",
      "priority": 1,
      "passes": false,
      "verification": [
        "/brainstorm command accepts feature ID or description",
        "Drafting phase spawns 3+ agents with different perspectives",
        "Round 2 agents see Round 1 summaries for competitive awareness",
        "Ranking phase scores approaches using strict criteria",
        "Synthesis phase combines top approaches into unified plan",
        "Critique phase identifies flaws before finalization",
        "Output saved to .claude-harness/brainstorms/{feature}/",
        "Integration with /plan-feature as optional brainstorm-first mode",
        "Memory persistence of successful brainstorm patterns"
      ],
      "verificationCommands": {
        "build": null,
        "tests": null,
        "lint": null,
        "typecheck": null,
        "custom": [
          "test -f commands/brainstorm.md",
          "grep -q 'Drafting' commands/brainstorm.md",
          "grep -q 'Ranking' commands/brainstorm.md",
          "grep -q 'Synthesis' commands/brainstorm.md",
          "grep -q 'Critique' commands/brainstorm.md"
        ]
      },
      "maxAttempts": 10,
      "relatedFiles": [
        "commands/brainstorm.md",
        "commands/plan-feature.md",
        "commands/orchestrate.md",
        "setup.sh",
        "README.md"
      ],
      "github": {
        "issueNumber": null,
        "prNumber": null,
        "branch": null
      },
      "createdAt": "2026-01-09T10:00:00Z",
      "phase": "planned",
      "plan": {
        "steps": [
          {
            "step": 1,
            "description": "Create commands/brainstorm.md",
            "files": ["commands/brainstorm.md"],
            "details": "Define the brainstorm command with 5 phases: Drafting (3 agents x 2 rounds), Ranking (cross-agent scoring), Synthesis (merge top 3), Critique (identify flaws), Final Polish (incorporate feedback)"
          },
          {
            "step": 2,
            "description": "Define Agent Perspectives for Drafting",
            "files": ["commands/brainstorm.md"],
            "details": "Map different agent types to perspectives: architect-reviewer (system design), code-reviewer (implementation quality), performance-engineer (efficiency), security-auditor (risk assessment)"
          },
          {
            "step": 3,
            "description": "Implement Ranking Criteria",
            "files": ["commands/brainstorm.md"],
            "details": "Define scoring: Technical Feasibility (40%), Completeness (30%), Innovation (30%). Penalty for generic solutions. JSON output format for structured ranking."
          },
          {
            "step": 4,
            "description": "Design Synthesis Protocol",
            "files": ["commands/brainstorm.md"],
            "details": "Instructions to combine best elements: Cross-pollinate ideas explicitly, resolve conflicts by technical merit, attribute sources."
          },
          {
            "step": 5,
            "description": "Create Boardroom Critique Phase",
            "files": ["commands/brainstorm.md"],
            "details": "Each agent identifies 3 fatal flaws in the unified plan. Forces critical thinking before finalization."
          },
          {
            "step": 6,
            "description": "Add Output Persistence",
            "files": ["commands/brainstorm.md", "setup.sh"],
            "details": "Save brainstorm outputs to .claude-harness/brainstorms/{feature}/. Update setup.sh to create brainstorms/ directory."
          },
          {
            "step": 7,
            "description": "Integrate with plan-feature",
            "files": ["commands/plan-feature.md"],
            "details": "Add optional --brainstorm flag to plan-feature that runs brainstorm first for complex features."
          },
          {
            "step": 8,
            "description": "Update README documentation",
            "files": ["README.md"],
            "details": "Document new /brainstorm command and when to use it."
          },
          {
            "step": 9,
            "description": "Bump version to 3.5.0",
            "files": [".claude-plugin/plugin.json"],
            "details": "New feature release version."
          }
        ],
        "estimatedFiles": [
          "commands/brainstorm.md",
          "commands/plan-feature.md",
          "setup.sh",
          ".claude-plugin/plugin.json",
          "README.md"
        ],
        "impactScore": "medium",
        "risks": [
          "Token cost - running 3+ agents x 2 rounds is expensive",
          "Time - full brainstorm cycle may take 10-20 minutes",
          "Quality variance - agent responses may be inconsistent",
          "Over-engineering - simple features don't need brainstorming"
        ],
        "mitigations": [
          "Add --quick flag for single-round brainstorm",
          "Document when to use brainstorm vs direct planning",
          "Use structured prompts with examples for consistency",
          "Cache results for interrupted sessions"
        ],
        "dependencies": [
          "Task tool with subagent_type support",
          "Existing orchestration infrastructure"
        ],
        "sourceInspiration": {
          "repo": "alrightryanx/ralph-brainstormer",
          "patterns": [
            "Multi-round drafting with competitive awareness",
            "Cross-agent ranking with strict scoring",
            "Synthesis of best elements with attribution",
            "Boardroom critique before finalization"
          ]
        }
      },
      "tests": {
        "generated": false,
        "files": []
      }
    },
    {
      "id": "feature-008",
      "name": "Agent Lifecycle Hooks Integration (Claude Code v2.1.0)",
      "description": "Integrate Claude Code v2.1.0 agent lifecycle hooks into the harness for automatic memory persistence during /implement loops. Includes PreToolUse (check learned rules), PostToolUse (record file changes), Stop (auto-checkpoint), and SessionStart with once:true.",
      "priority": 1,
      "passes": true,
      "verification": [
        "PreToolUse hook validates against learned rules before tool execution",
        "PostToolUse hook records file modifications to procedural memory",
        "Stop hook auto-checkpoints on loop end",
        "SessionStart hook only runs once per session (once: true)",
        "Hooks execute during /implement loops",
        "Memory updates are persisted correctly"
      ],
      "verificationCommands": {
        "build": null,
        "tests": null,
        "lint": null,
        "typecheck": null,
        "custom": [
          "cat hooks/hooks.json | grep -q 'once'",
          "test -f hooks/pre-tool-check.sh",
          "test -f hooks/post-tool-record.sh",
          "test -f hooks/loop-checkpoint.sh"
        ]
      },
      "maxAttempts": 10,
      "relatedFiles": [
        "hooks/hooks.json",
        "hooks/pre-tool-check.sh",
        "hooks/post-tool-record.sh",
        "hooks/loop-checkpoint.sh",
        "hooks/session-start.sh",
        "commands/implement.md"
      ],
      "github": {
        "issueNumber": 18,
        "prNumber": null,
        "branch": "feature/feature-008-agent-hooks"
      },
      "createdAt": "2026-01-08T17:48:00Z",
      "phase": "planned",
      "plan": {
        "steps": [
          {
            "step": 1,
            "description": "Update hooks/hooks.json - Add once:true to SessionStart hook",
            "files": ["hooks/hooks.json"],
            "details": "Add 'once': true to prevent duplicate memory compilation on session resume"
          },
          {
            "step": 2,
            "description": "Update hooks/hooks.json - Add PreToolUse hook",
            "files": ["hooks/hooks.json"],
            "details": "Add PreToolUse hook that runs pre-tool-check.sh before Write/Edit/Bash tools"
          },
          {
            "step": 3,
            "description": "Update hooks/hooks.json - Add PostToolUse hook",
            "files": ["hooks/hooks.json"],
            "details": "Add PostToolUse hook that runs post-tool-record.sh after Write/Edit tools"
          },
          {
            "step": 4,
            "description": "Update hooks/hooks.json - Add Stop hook",
            "files": ["hooks/hooks.json"],
            "details": "Add Stop hook that runs loop-checkpoint.sh when agent loop ends"
          },
          {
            "step": 5,
            "description": "Create hooks/pre-tool-check.sh",
            "files": ["hooks/pre-tool-check.sh"],
            "details": "Shell script that reads learned rules from memory/learned/rules.json and validates proposed tool use against them. Outputs warnings via systemMessage if rules violated."
          },
          {
            "step": 6,
            "description": "Create hooks/post-tool-record.sh",
            "files": ["hooks/post-tool-record.sh"],
            "details": "Shell script that records file modifications to memory/procedural/ after Write/Edit tools. Captures file paths, timestamps, and context for future reference."
          },
          {
            "step": 7,
            "description": "Create hooks/loop-checkpoint.sh",
            "files": ["hooks/loop-checkpoint.sh"],
            "details": "Shell script that auto-saves working context and optionally stages changes when an agent loop completes (Stop hook). Persists decisions to episodic memory."
          },
          {
            "step": 8,
            "description": "Bump plugin version to 3.4.0",
            "files": [".claude-plugin/plugin.json"],
            "details": "Update version for new lifecycle hooks feature"
          },
          {
            "step": 9,
            "description": "Test hook execution",
            "files": [],
            "details": "Verify hooks fire correctly during /implement loops and memory is persisted"
          }
        ],
        "estimatedFiles": [
          "hooks/hooks.json",
          "hooks/pre-tool-check.sh",
          "hooks/post-tool-record.sh",
          "hooks/loop-checkpoint.sh",
          ".claude-plugin/plugin.json"
        ],
        "impactScore": "medium",
        "risks": [
          "Hook timeout could interrupt tool execution if scripts are slow",
          "JSON parsing in shell scripts may be fragile",
          "Claude Code hook input format may differ from expectations"
        ],
        "mitigations": [
          "Keep hook scripts fast (<5 seconds), use reasonable timeouts",
          "Use jq for robust JSON parsing where available, fallback to grep",
          "Test with actual Claude Code v2.1.0 to validate hook input format"
        ],
        "dependencies": [
          "Claude Code v2.1.0 with agent lifecycle hooks support",
          "Existing memory layer structure (.claude-harness/memory/)"
        ]
      },
      "tests": {
        "generated": false,
        "files": []
      }
    }
  ],
  "fixes": []
}
