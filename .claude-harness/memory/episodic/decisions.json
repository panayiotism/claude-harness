{
  "maxEntries": 50,
  "entries": [
    {
      "id": "dec-20260110-001",
      "timestamp": "2026-01-10T05:20:00Z",
      "feature": "feature-011",
      "decision": "Use deny > ask > allow precedence for permission safety",
      "rationale": "Deny rules must have highest precedence to block dangerous commands even if they match ask/allow patterns",
      "alternatives": ["Only use allow list", "Use ask for everything"],
      "impact": ".claude/settings.json, .claude/settings.local.json"
    },
    {
      "id": "dec-20260110-002",
      "timestamp": "2026-01-10T05:20:00Z",
      "feature": "feature-011",
      "decision": "Put rm:* in ask list with specific dangerous patterns in deny",
      "rationale": "This allows safe rm commands (like rm node_modules) with user confirmation, while blocking destructive patterns (rm -rf /) unconditionally",
      "alternatives": ["Block all rm commands", "Allow all rm commands"],
      "impact": ".claude/settings.json"
    },
    {
      "id": "dec-20260110-003",
      "timestamp": "2026-01-10T05:20:00Z",
      "feature": "feature-011",
      "decision": "Create both settings.json (shared) and settings.local.json (personal)",
      "rationale": "Team-shared settings ensure consistent safety across all users, while personal settings allow customization without affecting others",
      "alternatives": ["Only create settings.local.json"],
      "impact": ".claude/settings.json, .claude/settings.local.json"
    },
    {
      "id": "dec-20260115-001",
      "timestamp": "2026-01-15T14:35:00Z",
      "feature": "feature-012",
      "decision": "Create separate /do-tdd command instead of --tdd flag on /do",
      "rationale": "User preferred explicit command over additional flag to reduce complexity. Separate command makes TDD workflow first-class and clear.",
      "alternatives": ["Add --tdd flag to /do", "Make TDD default with --skip-tdd opt-out"],
      "impact": "commands/do-tdd.md, README.md"
    },
    {
      "id": "dec-20260115-002",
      "timestamp": "2026-01-15T14:35:00Z",
      "feature": "feature-012",
      "decision": "Enforce test existence gate - block implementation until tests exist",
      "rationale": "True TDD requires tests to exist before implementation. Gate ensures workflow is followed, not just suggested.",
      "alternatives": ["Warning only (no blocking)", "Optional enforcement via flag"],
      "impact": "commands/do-tdd.md"
    },
    {
      "id": "dec-20260115-003",
      "timestamp": "2026-01-15T14:35:00Z",
      "feature": "feature-012",
      "decision": "Use RED-GREEN-REFACTOR phases with explicit phase tracking",
      "rationale": "Classic TDD cycle provides clear structure. Phase tracking in loop state enables resume from any point.",
      "alternatives": ["Simple test-first without phases", "Only track test pass/fail"],
      "impact": "commands/do-tdd.md, .claude-harness/loops/state.json schema"
    },
    {
      "id": "dec-20260115-004",
      "timestamp": "2026-01-15T15:00:00Z",
      "feature": "feature-012",
      "decision": "Re-tag version after merge to include actual feature code",
      "rationale": "v3.7.0 was originally tagged on pre-merge commit. After squash merge, tag needed to be moved to include the actual feature implementation.",
      "alternatives": ["Keep old tag", "Bump to v3.7.1"],
      "impact": "Git tags, GitHub releases"
    },
    {
      "id": "dec-20260115-005",
      "timestamp": "2026-01-15T15:00:00Z",
      "feature": "feature-012",
      "decision": "Use squash merge for feature PRs",
      "rationale": "Squash merge keeps main branch clean with one commit per feature. Preserves full history in PR for reference.",
      "alternatives": ["Merge commit", "Rebase and merge"],
      "impact": "Git history on main branch"
    },
    {
      "id": "dec-20260116-001",
      "timestamp": "2026-01-16T07:15:00Z",
      "feature": "feature-013",
      "decision": "Use quoted heredoc for init.sh content in setup.sh",
      "rationale": "Single quotes inside single-quoted string caused syntax error. Quoted heredoc (<<'EOF') preserves all special characters including single quotes",
      "alternatives": ["Escape quotes manually", "Use different delimiter syntax"],
      "impact": "setup.sh"
    },
    {
      "id": "dec-20260116-002",
      "timestamp": "2026-01-16T07:15:00Z",
      "feature": "feature-013",
      "decision": "Make gitignore update MANDATORY in /setup command",
      "rationale": "Previous soft instructions were not being followed. CRITICAL + DO NOT SKIP ensures ephemeral files are properly gitignored",
      "alternatives": ["Keep as optional", "Only add to setup.sh"],
      "impact": "commands/setup.md"
    },
    {
      "id": "dec-20260116-003",
      "timestamp": "2026-01-16T16:50:00Z",
      "feature": "feature-013",
      "decision": "Add CRITICAL marker and explicit DO NOT warning for multiSelect requirement",
      "rationale": "User reported that in plugin installations, the interactive menu only allowed single selection despite multiSelect: true in docs. More explicit instructions needed to ensure Claude follows the requirement.",
      "alternatives": ["Keep subtle instruction", "Remove multi-select entirely"],
      "impact": "commands/do.md"
    },
    {
      "id": "dec-20260201-001",
      "timestamp": "2026-02-01T12:00:00Z",
      "feature": "hotfix",
      "decision": "Convert Stop hook from prompt-type to command-type",
      "rationale": "Prompt-type hooks require a model to generate valid JSON on every stop/interrupt. This is inherently unreliable - the model can produce trailing backslashes, extra text, or malformed JSON, causing 'JSON validation failed' errors. Shell scripts are deterministic and never fail validation.",
      "alternatives": ["Simplify the prompt", "Remove Stop hook entirely", "Add retry logic"],
      "impact": "hooks/hooks.json, hooks/stop.sh"
    },
    {
      "id": "dec-20260206-001",
      "timestamp": "2026-02-06T15:45:00Z",
      "feature": "v5.0.0",
      "decision": "Stay within 200K standard context - do not use 1M beta context",
      "rationale": "1M context window is still in beta and triggers premium pricing ($10/$37.50 per MTok vs standard $5/$25 for >200K input). Requires usage tier 4 orgs. Not worth the cost increase for most users.",
      "alternatives": ["Use 1M context with tier detection", "3-tier system (standard/opus46/opus46-extended)"],
      "impact": "All commands - no memory limit changes needed"
    },
    {
      "id": "dec-20260206-002",
      "timestamp": "2026-02-06T15:45:00Z",
      "feature": "v5.0.0",
      "decision": "Effort annotations are advisory - backward compatible with older models",
      "rationale": "Models without effort controls simply ignore the annotations. This ensures the plugin works identically on older models while optimizing cost/quality on Opus 4.6+.",
      "alternatives": ["Model detection with conditional behavior", "Separate command variants per model"],
      "impact": "commands/flow.md, do.md, do-tdd.md, orchestrate.md"
    },
    {
      "id": "dec-20260206-003",
      "timestamp": "2026-02-06T15:45:00Z",
      "feature": "v5.0.0",
      "decision": "Agent Teams as preferred spawning mechanism with Task tool fallback",
      "rationale": "Agent Teams (research preview) provides native parallel agent spawning with separate context windows. Better coordination than custom Task tool approach. Fallback ensures compatibility when Agent Teams is unavailable.",
      "alternatives": ["Only use Task tool", "Only use Agent Teams (no fallback)", "Configurable via settings"],
      "impact": "commands/do.md, do-tdd.md, orchestrate.md"
    },
    {
      "id": "dec-20260206-004",
      "timestamp": "2026-02-06T15:45:00Z",
      "feature": "v5.0.0",
      "decision": "Increase maxAttempts from 10 to 15 across all commands",
      "rationale": "Opus 4.6 sustains longer agentic tasks with better debugging. 15 attempts with progressive effort escalation (high → max → max+memory) provides more runway for complex issues.",
      "alternatives": ["Keep at 10", "Increase to 20", "Make configurable per-project"],
      "impact": "commands/flow.md, do.md, do-tdd.md, checkpoint.md, setup.md, README.md"
    },
    {
      "id": "dec-20260206-005",
      "timestamp": "2026-02-06T15:45:00Z",
      "feature": "v5.0.0",
      "decision": "Simple single-update approach instead of complex tier system",
      "rationale": "User explicitly requested simplicity. All Opus 4.6 features are backward-compatible, so no need for model detection or tiered behavior. One plugin version works for all models.",
      "alternatives": ["3-tier system with model detection", "Feature flags per capability"],
      "impact": "Entire plugin architecture - kept simple"
    },
    {
      "id": "dec-20260207-001",
      "timestamp": "2026-02-07T15:00:00Z",
      "feature": "v6.0.0",
      "decision": "Replace entire subagent pipeline with Agent Teams as sole orchestration model",
      "rationale": "Agent Teams enable direct inter-agent messaging (reviewer↔implementer) which eliminates the lossy lead-intermediated handoffs of the old subagent pipeline. Per-feature specialist teams (test-writer, implementer, reviewer) naturally enforce TDD.",
      "alternatives": ["Keep subagent pipeline with Agent Teams as opt-in", "Dual orchestration with fallback"],
      "impact": "commands/flow.md (major rewrite), hooks/, setup.sh"
    },
    {
      "id": "dec-20260207-002",
      "timestamp": "2026-02-07T15:00:00Z",
      "feature": "v6.0.0",
      "decision": "Remove --tdd flag - TDD is always-on via team structure",
      "rationale": "The 3-specialist team (test-writer=RED, implementer=GREEN, reviewer=REFACTOR) IS the TDD cycle by design. A separate flag is redundant.",
      "alternatives": ["Keep --tdd as explicit opt-in", "Add --skip-tdd to opt out"],
      "impact": "commands/flow.md, CLAUDE.md, README.md, session-start.sh, init.sh"
    },
    {
      "id": "dec-20260207-003",
      "timestamp": "2026-02-07T15:00:00Z",
      "feature": "v6.0.0",
      "decision": "Remove worktree support entirely - Agent Teams handle parallelism",
      "rationale": "Agent Teams teammates each get their own Claude Code instance, making worktree-based isolation unnecessary. Removes complexity from 6 files without losing functionality.",
      "alternatives": ["Keep worktree as optional utility", "Only remove from flow, keep manual command"],
      "impact": "commands/worktree.md (deleted), flow.md, start.md, checkpoint.md, session-start.sh, setup.sh, README.md"
    },
    {
      "id": "dec-20260207-004",
      "timestamp": "2026-02-07T16:30:00Z",
      "feature": "v6.0.1",
      "decision": "Add migrate_to_v6() to setup.sh for automatic cleanup on upgrade",
      "rationale": "Target projects upgrading from v5.x retain stale artifacts (worktrees/, handoffs.json, obsolete commands). Automatic migration prevents confusion and stale state.",
      "alternatives": ["Manual cleanup instructions in changelog", "Force overwrite all files"],
      "impact": "setup.sh"
    },
    {
      "id": "dec-20260207-005",
      "timestamp": "2026-02-07T16:30:00Z",
      "feature": "v6.0.1",
      "decision": "Use python3 JSON merge for settings.local.json env var injection",
      "rationale": "create_file skips existing files. sed-based JSON manipulation is fragile. python3 json.load/dump safely merges the Agent Teams env var into any existing settings.local.json without losing user customizations.",
      "alternatives": ["sed-based injection", "Force overwrite settings.local.json", "Require manual setup"],
      "impact": "setup.sh, .claude/settings.local.json"
    },
    {
      "id": "dec-20260207-006",
      "timestamp": "2026-02-07T16:30:00Z",
      "feature": "v6.0.1",
      "decision": "Agent Teams env var blocker at session-start and flow Phase 0",
      "rationale": "Agent Teams is required for v6+ (all workflows depend on it). Blocking early prevents confusing failures deep in the workflow. Hooks can't set env vars (child process), so user must run setup + restart.",
      "alternatives": ["Warning only (non-blocking)", "Auto-enable via hook (impossible — child process)"],
      "impact": "hooks/session-start.sh, commands/flow.md"
    },
    {
      "id": "dec-20260207-007",
      "timestamp": "2026-02-07T17:00:00Z",
      "feature": "v6.1.0",
      "decision": "External GitHub version check to detect stale plugin cache",
      "rationale": "The version detection was self-referential — both PLUGIN_VERSION and .plugin-version came from the same stale cache, so no mismatch was ever detected. An external check (GitHub API) breaks the loop.",
      "alternatives": ["Rely on claude plugin update (broken)", "Only document manual fix", "Auto-update cache from hook (too invasive)"],
      "impact": "hooks/session-start.sh, fix-stale-cache.sh (new)"
    },
    {
      "id": "dec-20260207-008",
      "timestamp": "2026-02-07T17:00:00Z",
      "feature": "v6.1.0",
      "decision": "Self-contained fix-stale-cache.sh bootstrap script runnable via curl pipe",
      "rationale": "Stuck users can't benefit from session-start.sh improvements (they're running the old cached version). A curl-piped script runs independently of the cache, downloads the latest tarball, replaces the cache dir, and updates installed_plugins.json. Pattern proven safe by dev-mode.sh.",
      "alternatives": ["Require manual cache deletion + reinstall", "Embed update logic in session-start hook"],
      "impact": "fix-stale-cache.sh, ~/.claude/plugins/"
    },
    {
      "id": "dec-20260208-001",
      "timestamp": "2026-02-08T11:00:00Z",
      "feature": "v6.2.0",
      "decision": "Migrate prd-breakdown from subagent pipeline to Agent Teams with same patterns as /flow",
      "rationale": "v6.0.0 established Agent Teams as sole orchestration model but prd-breakdown was missed. Using same teammate pattern (delegate mode, TeammateIdle notifications, team cleanup) ensures consistency across all commands.",
      "alternatives": ["Keep subagent/Task tool approach for PRD only", "Remove parallel analysis entirely"],
      "impact": "commands/prd-breakdown.md, .claude/commands/prd-breakdown.md, setup.sh, README.md"
    },
    {
      "id": "dec-20260208-002",
      "timestamp": "2026-02-08T11:00:00Z",
      "feature": "v6.2.0",
      "decision": "Rename subagent-prompts.json to analyst-prompts.json",
      "rationale": "Aligns file naming with Agent Teams terminology. Prompts are now provided inline at teammate spawn time rather than loaded from external file, but the file is kept for reference/customization.",
      "alternatives": ["Keep old filename", "Remove the prompts file entirely"],
      "impact": "setup.sh, README.md directory tree"
    },
    {
      "id": "dec-20260208-003",
      "timestamp": "2026-02-08T11:30:00Z",
      "feature": "v6.2.1",
      "decision": "Persist delegation mode to autonomous-state.json and re-read at every loop iteration",
      "rationale": "Delegation instructions existed only in conversation context, which gets lost during context compaction in long autonomous sessions. Writing leadMode and leadModeRule to disk and re-reading at Phase A.2, A.4.4 gate, and A.6 ensures the instruction survives compaction.",
      "alternatives": ["Add a hook to reinforce delegate mode", "Only re-read at Phase A.4.4", "Store in context.json instead"],
      "impact": "commands/flow.md (autonomous-state.json v2, loop-state team object, 3 re-read points)"
    },
    {
      "id": "dec-20260208-004",
      "timestamp": "2026-02-08T13:00:00Z",
      "feature": "v6.3.0",
      "decision": "Use marker file (.recovery/interrupted.json) instead of mutating loop-state.json in bash",
      "rationale": "Bash JSON mutation via sed is fragile and error-prone. A separate marker file is idempotent, robust, and requires no jq dependency. The file's existence IS the state.",
      "alternatives": ["sed-based JSON status replacement", "python3 JSON manipulation", "Add interrupted field to loop-state.json"],
      "impact": "hooks/session-start.sh, hooks/stop.sh, commands/flow.md"
    },
    {
      "id": "dec-20260208-005",
      "timestamp": "2026-02-08T13:00:00Z",
      "feature": "v6.3.0",
      "decision": "Primary interrupt detection in session-start.sh stale session cleanup, not Stop hook",
      "rationale": "Stop hook does NOT fire on user interrupts (Ctrl+C/Escape) — only on natural stops. The session-start.sh stale session cleanup (PID check) is the only reliable way to detect interrupted sessions. Stop hook serves as secondary detection for natural stops.",
      "alternatives": ["Rely solely on Stop hook", "Add a custom interrupt signal handler", "Use PreCompact hook"],
      "impact": "hooks/session-start.sh (primary), hooks/stop.sh (secondary)"
    },
    {
      "id": "dec-20260208-006",
      "timestamp": "2026-02-08T13:00:00Z",
      "feature": "v6.3.0",
      "decision": "Offer 3 recovery options on interrupt resume (fresh approach, retry same, reset)",
      "rationale": "Users interrupt for different reasons: wrong approach (need fresh), accidental (retry same), or fundamental issue (need reset). Autonomous mode auto-selects fresh approach since no user is present to choose.",
      "alternatives": ["Always increment attempt", "Always reset to attempt 1", "Only offer 2 options"],
      "impact": "commands/flow.md Resume Behavior section"
    },
    {
      "id": "dec-20260208-007",
      "timestamp": "2026-02-08T15:00:00Z",
      "feature": "v6.4.0",
      "decision": "Use PreToolUse with dual matchers (Bash + Edit|Write) instead of a single catch-all",
      "rationale": "Different tool types need different validation logic. Bash needs command string analysis (git checkout main, push --force), while Edit/Write needs file path analysis (loop-state.json, hooks/). Single script handles both via tool_name branching, but separate matchers ensure the hook only fires for relevant tools.",
      "alternatives": ["Single matcher-less hook that checks all tools", "Separate scripts per matcher"],
      "impact": "hooks/pre-tool-use.sh, hooks/hooks.json (2 PreToolUse entries)"
    },
    {
      "id": "dec-20260208-008",
      "timestamp": "2026-02-08T15:00:00Z",
      "feature": "v6.4.0",
      "decision": "PostToolUse runs async for non-blocking streaming verification",
      "rationale": "Running tests synchronously after every Edit/Write would block the agent for 5-30 seconds per edit. Async mode runs tests in background and delivers results next turn via additionalContext, enabling the agent to continue working while verification happens.",
      "alternatives": ["Synchronous verification (blocking)", "Only verify on TeammateIdle (late feedback)", "Custom test-watcher daemon"],
      "impact": "hooks/post-tool-use.sh, hooks/hooks.json (async: true)"
    },
    {
      "id": "dec-20260208-009",
      "timestamp": "2026-02-08T15:00:00Z",
      "feature": "v6.4.0",
      "decision": "PermissionRequest hook is no-op in standard mode, only activates in autonomous mode",
      "rationale": "In standard mode, users can review and approve permissions themselves. Auto-approving would reduce user control. In autonomous mode, there's no user present, so safe operations should auto-approve and destructive ones should auto-deny to prevent the agent from getting stuck on permission prompts.",
      "alternatives": ["Always active with configurable allow lists", "Auto-approve all in autonomous mode", "Never auto-approve (let Claude Code handle it)"],
      "impact": "hooks/permission-request.sh"
    }
  ]
}
