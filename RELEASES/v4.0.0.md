# Release v4.0.0 - PRD Analysis & Decomposition

## What's Changed

### Major Feature: PRD Breakdown Command
- **New `/claude-harness:prd-breakdown` command** for analyzing Product Requirements Documents
- Automatically decomposes PRDs into atomic features using AI-powered analysis
- Parallel multi-agent decomposition (Product Analyst, Architect, QA Lead)
- Essential for bootstrapping feature lists in new projects

### PRD Analysis Workflow

#### Phase 0: Input Detection
Multiple input methods supported:
- **Inline**: `/prd-breakdown "Your PRD markdown..."`
- **File**: `/prd-breakdown --file ./docs/prd.md`
- **GitHub**: `/prd-breakdown --url https://github.com/.../issues/42`
- **Interactive**: Prompted if no input provided

#### Phase 1: Parallel Subagent Analysis
Three specialized agents analyze the PRD simultaneously:

1. **Product Analyst**
   - Extracts business goals and success metrics
   - Identifies user personas and use cases
   - Lists functional requirements
   - Documents non-functional requirements
   - Maps external dependencies and constraints

2. **Architect**
   - Assesses technical feasibility of each requirement
   - Proposes implementation order (dependency ordering)
   - Identifies technical risks and mitigations
   - Suggests MVP features (essential for day-1)
   - Recommends tech stack decisions

3. **QA Lead**
   - Defines acceptance criteria (Given/When/Then format)
   - Identifies edge cases and error scenarios
   - Specifies performance and security requirements
   - Designs verification approach (unit/integration/E2E)
   - Documents test scenarios

#### Phase 2: Feature Decomposition
- Transforms analysis into atomic, implementable features
- Resolves dependencies (topological sort)
- Assigns priorities (MVP features first)
- Generates acceptance criteria per feature
- Calculates complexity and risk levels

#### Phase 3: Feature Review & Creation
- Preview breakdown with risk/complexity assessment
- Select features to create (or review/analyze-only modes)
- Generate features in `.claude-harness/features/active.json`
- Store PRD metadata with each feature for traceability

### Storage Structure

New `.claude-harness/prd/` directory:
```
.claude-harness/prd/
├── input.md                  # Original PRD document
├── metadata.json             # PRD metadata and hash
├── analysis.json             # Subagent analysis results
├── breakdown.json            # Decomposed features
└── subagent-prompts.json     # Reusable subagent prompts
```

### New Command Options

| Option | Behavior |
|--------|----------|
| `/prd-breakdown "PRD..."` | Analyze inline PRD |
| `--file ./prd.md` | Read PRD from file |
| `--url https://...` | Fetch PRD from GitHub issue |
| `--analyze-only` | Run analysis without creating features |
| `--auto` | No prompts, create all features |
| `--max-features 10` | Limit to 10 highest-priority features |

### New 9-Command Structure

| # | Command | Purpose |
|---|---------|---------|
| 1 | `/setup` | Initialize harness (one-time) |
| 2 | `/start` | Compile context, show status |
| **2b** | **`/prd-breakdown`** | **Analyze PRD → extract atomic features** |
| 3 | `/do` | Unified workflow (features + fixes) |
| 3b | `/do-tdd` | TDD workflow (tests first) |
| 4 | `/checkpoint` | Manual commit + push + PR |
| 5 | `/worktree` | Manage worktrees (list, remove, prune) |
| 6 | `/orchestrate` | Multi-agent team (advanced) |
| 7 | `/merge` | Merge PRs, auto-version, release |

### TL;DR Section Updated

README now includes PRD bootstrap workflow:
```bash
/prd-breakdown "Your PRD..."           # Analyze inline
/prd-breakdown --file ./docs/prd.md    # Read from file
/prd-breakdown --url https://github... # Fetch from GitHub
```

### Documentation Updates

- Command reference now lists 9 commands (was 8)
- TL;DR section includes PRD breakdown workflow
- Directory structure documentation updated
- Version references bumped: v3.9 → v4.0.0

### Version Updates

- **plugin.json**: v3.9.6 → v4.0.0
- **setup.sh**: v3.9 → v4.0
- **session-start.sh**: v3.9.0 → v4.0.0
- **README.md**: Display v4.0.0 in session banner
- **claude-progress.json**: Updated changelog with v4.0.0 entry

### Integration with Existing Commands

- Created features integrate seamlessly with `/do` workflow
- Each feature includes auto-detected verification commands (build, test, lint, typecheck)
- PRD metadata stored per-feature for cross-referencing
- Analysis results preserved for auditing and future improvements

### Future Enhancements (Post-MVP)

Planned for future versions:
- PRD diffing (detect changes, suggest new features)
- Feature linking visualization
- Effort estimation from user feedback
- Metrics tracking (PRD features vs. built features)
- Rollback capabilities
- Interactive UI-based feature picker
- Multi-PRD support with feature merging
- Domain-specific subagents (UX specialist, Security specialist)

---

## Breaking Changes

None - this is a pure feature addition. All existing commands and workflows remain unchanged.

## Files Changed

- `commands/prd-breakdown.md` - New command definition
- `.claude-harness/prd/subagent-prompts.json` - New subagent templates
- `setup.sh` - Added PRD directory initialization
- `hooks/session-start.sh` - Version bump
- `.claude-plugin/plugin.json` - Version bump to v4.0.0
- `README.md` - Updated command reference and TL;DR
- `.claude-harness/claude-progress.json` - Updated changelog

## Commit

**a345fba** - `feat(prd-breakdown): Add PRD analysis command with multi-agent decomposition`

---

**Full Changelog**: https://github.com/panayiotism/claude-harness/compare/v3.9.6...v4.0.0

## Migration Notes

No migration needed. This is a backward-compatible addition.

- Existing harnesses continue to work unchanged
- New projects can optionally use `/prd-breakdown` to bootstrap features
- Existing features and workflows are unaffected

## Testing Recommendations

1. **Simple PRD**: Test with 5-feature PRD to verify all 3 agents complete
2. **Complex PRD**: Test with 50+ requirement PRD to verify dependency ordering
3. **GitHub integration**: Test `--url` flag with real GitHub issues
4. **Feature generation**: Verify created features work with `/do` workflow
5. **Re-analysis**: Test PRD hash detection for update scenarios
