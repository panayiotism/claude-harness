# Release v4.1.0 - Auto-Create GitHub Issues from PRD

## What's Changed

### Major Feature: Auto-Create GitHub Issues

- **New `--create-issues` flag** on `/prd-breakdown` command
- Automatically creates one GitHub issue per generated feature
- Designed with explicit opt-in (not automatic) for safety and user control
- Enables teams to go from PRD → features → tracked GitHub backlog in one command

### GitHub Issue Creation Workflow

#### Phase 3.5: GitHub Issue Creation (NEW)

When `--create-issues` flag is provided:

1. **Issue Payload**: One issue per feature with:
   - **Title**: Feature name (e.g., "Session-scoped state management")
   - **Body**: Feature description + acceptance criteria + priority
   - **Labels**: `feature`, `prd-generated`
   - **Metadata**: Links to PRD breakdown for traceability

2. **Creation Process**:
   - Uses Claude Code's GitHub MCP integration
   - Parses GitHub owner/repo from `git remote get-url origin`
   - Creates issues sequentially (with rate limit handling)
   - Updates feature metadata with `github.issueNumber`

3. **Error Handling**:
   - GitHub MCP unavailable → Skips issue creation, continues with feature creation
   - Permission denied → Logs error, continues with other features
   - Rate limited → Adds 500ms delay between requests
   - Network error → Retries 3x with exponential backoff

### Command Usage

```bash
# Manual review then create issues
/prd-breakdown @./prd.md --create-issues

# Fully automated (review + feature creation + issue creation)
/prd-breakdown @./prd.md --create-issues --auto

# From GitHub issue with auto-creation
/prd-breakdown --url https://github.com/org/repo/issues/25 --create-issues --auto
```

### Updated Command Options

| Option | Behavior |
|--------|----------|
| `--create-issues` | Create GitHub issues for each generated feature |
| `--create-issues --auto` | Full automation: features + issues, no prompts |
| (existing flags) | All existing flags still work as before |

### Design Philosophy: Explicit Opt-In (Not Automatic)

**Why not automatic?**
- ❌ Premature commitment before review
- ❌ Permission issues (fork PRs can't create upstream issues)
- ❌ Doesn't respect team workflows
- ❌ Could spam with 20+ unwanted issues

**Why explicit opt-in is better?**
- ✅ Preserves user control
- ✅ Backward compatible (existing behavior unchanged)
- ✅ Graceful degradation (works without GitHub MCP)
- ✅ Teams choose their own automation level

**Respects team preference for full automation once flag is used:**
- No confirmation prompts during issue creation
- One command handles everything: analyze → create features → create issues
- Fast and efficient for teams that want it

### Data Structure Updates

Features now track how they were created:

```json
{
  "id": "feature-XXX",
  "name": "...",
  "github": {
    "issueNumber": 42,  // NOW POPULATED if --create-issues used
    "prNumber": null,
    "branch": "feature/feature-XXX"
  },
  "prdMetadata": {
    "breakdown": "prd-{date}-{hash}",
    "createdViaFlag": "--create-issues"  // Tracks automation source
  }
}
```

### Documentation Updates

- **commands/prd-breakdown.md**: Added Phase 3.5 with detailed workflow
- **commands/prd-breakdown.md**: Added `--create-issues` flag documentation section
- **commands/prd-breakdown.md**: Updated error handling for GitHub scenarios
- **README.md**: Updated TL;DR section with `--create-issues` example
- **README.md**: Added "Auto-Creating GitHub Issues from PRD" section
- **README.md**: Updated command options table with new flag

### Version Updates

- **plugin.json**: v4.0.0 → v4.1.0
- **setup.sh**: v4.0.0 → v4.1.0
- **README.md**: Display v4.1.0 in banner and release notes

### Integration with Existing Commands

- Works seamlessly with existing `/do` workflow
- Features created with `--create-issues` have bidirectional GitHub links
- Issue numbers stored in feature metadata for tracking
- All existing features/workflows unaffected

### What This Enables

**Before v4.1.0:**
```
PRD → Manual analysis needed
     → Features created in harness only
     → GitHub issues created manually
     → No automatic linkage
```

**After v4.1.0:**
```
PRD → Analyzed by 3 agents
    → Features created in harness with PRD metadata
    → GitHub issues created automatically
    → Complete bidirectional traceability
    → Team has full visibility via GitHub
```

**Example workflow:**
```bash
/prd-breakdown @./requirements.md --create-issues --auto
```

Result:
- ✓ PRD analyzed with Product Analyst, Architect, QA Lead
- ✓ 8 atomic features created in `.claude-harness/features/active.json`
- ✓ 8 GitHub issues created (#123-#130)
- ✓ All linked with metadata for cross-referencing
- ✓ Team can see backlog and start assigning work
- ✓ Implement with `/do feature-001`, track progress on GitHub

---

## Breaking Changes

None - this is a pure feature addition with explicit opt-in.

All existing commands and workflows remain unchanged:
- Existing `/prd-breakdown` behavior unchanged (no `--create-issues` needed)
- Existing features and issues unaffected
- All other harness commands work as before

## Files Changed

- `commands/prd-breakdown.md` - Added Phase 3.5 and `--create-issues` flag
- `README.md` - Updated version, command options, and examples
- `.claude-plugin/plugin.json` - Version bump to v4.1.0
- `setup.sh` - Version bump to v4.1.0

## Commits

**2521890** - `feat: Add --create-issues flag to prd-breakdown command`

---

**Full Changelog**: https://github.com/panayiotism/claude-harness/compare/v4.0.0...v4.1.0

## Migration Notes

No migration needed. This is a backward-compatible addition.

- Existing harnesses continue to work unchanged
- No changes to existing `/prd-breakdown` behavior without `--create-issues` flag
- New projects can optionally use `--create-issues` for automatic GitHub tracking
- Existing features and workflows are unaffected

## Testing Recommendations

1. **Basic usage**: `/prd-breakdown @./test-prd.md --create-issues`
   - Verify issues created with proper labels and content

2. **Full automation**: `/prd-breakdown @./test-prd.md --create-issues --auto`
   - Verify no prompts, all features created with issues

3. **Error handling**: Test with no GitHub MCP configured
   - Verify graceful degradation (features created, issues skipped)

4. **Large PRD**: Test with 20+ features
   - Verify rate limit handling (500ms delays work correctly)

5. **Permission error**: Test with repo without write permissions
   - Verify error logging, continuation with other features

6. **Feature linkage**: Verify `github.issueNumber` updated correctly
   - Cross-reference features in active.json with GitHub issues

---

## Questions?

See the full [README.md](../README.md) for complete documentation on the `/prd-breakdown` command and related workflows.
